<script>
    // 主題與 Modal 邏輯
    const themes = {
        default: { '--bg-color': '#000000', '--text-color': '#ffffff', '--text-sub': '#bdbdbd', '--accent-color': '#ffffff', '--surface': 'rgba(255, 255, 255, 0.08)', '--surface-light': 'rgba(255, 255, 255, 0.12)', '--border-light': 'rgba(255, 255, 255, 0.15)', '--border-medium': 'rgba(255, 255, 255, 0.25)', '--option-bg': 'rgba(0, 0, 0, 0.3)', '--map-filter': 'grayscale(100%) invert(100%) contrast(90%)' },
        light: { '--bg-color': '#f2f2f7', '--text-color': '#1c1c1e', '--text-sub': '#636366', '--accent-color': '#000000', '--surface': 'rgba(255, 255, 255, 0.8)', '--surface-light': 'rgba(255, 255, 255, 0.6)', '--border-light': 'rgba(0, 0, 0, 0.1)', '--border-medium': 'rgba(0, 0, 0, 0.2)', '--option-bg': 'rgba(255, 255, 255, 0.5)', '--map-filter': 'none' },
        midnight: { '--bg-color': '#0f172a', '--text-color': '#e2e8f0', '--text-sub': '#94a3b8', '--accent-color': '#38bdf8', '--surface': 'rgba(30, 41, 59, 0.7)', '--surface-light': 'rgba(51, 65, 85, 0.6)', '--border-light': 'rgba(148, 163, 184, 0.2)', '--border-medium': 'rgba(148, 163, 184, 0.4)', '--option-bg': 'rgba(15, 23, 42, 0.5)', '--map-filter': 'none' },
        forest: { '--bg-color': '#051910', '--text-color': '#e8f5e9', '--text-sub': '#a5d6a7', '--accent-color': '#66bb6a', '--surface': 'rgba(255, 255, 255, 0.05)', '--surface-light': 'rgba(255, 255, 255, 0.1)', '--border-light': 'rgba(165, 214, 167, 0.2)', '--border-medium': 'rgba(165, 214, 167, 0.3)', '--option-bg': 'rgba(0, 20, 10, 0.4)', '--map-filter': 'none' },
        latte: { '--bg-color': '#2c241b', '--text-color': '#ede0d4', '--text-sub': '#bcaaa4', '--accent-color': '#d7ccc8', '--surface': 'rgba(255, 255, 255, 0.06)', '--surface-light': 'rgba(255, 255, 255, 0.1)', '--border-light': 'rgba(215, 204, 200, 0.2)', '--border-medium': 'rgba(215, 204, 200, 0.3)', '--option-bg': 'rgba(62, 39, 35, 0.4)', '--map-filter': 'none' },
        lavender: { '--bg-color': '#f3e8ff', '--text-color': '#4c1d95', '--text-sub': '#7c3aed', '--accent-color': '#8b5cf6', '--surface': 'rgba(255, 255, 255, 0.6)', '--surface-light': 'rgba(255, 255, 255, 0.8)', '--border-light': 'rgba(139, 92, 246, 0.2)', '--border-medium': 'rgba(139, 92, 246, 0.3)', '--option-bg': 'rgba(139, 92, 246, 0.1)', '--map-filter': 'none' },
        sakura: { '--bg-color': '#fff0f5', '--text-color': '#9d174d', '--text-sub': '#db2777', '--accent-color': '#f472b6', '--surface': 'rgba(255, 255, 255, 0.6)', '--surface-light': 'rgba(255, 255, 255, 0.8)', '--border-light': 'rgba(236, 72, 153, 0.2)', '--border-medium': 'rgba(236, 72, 153, 0.3)', '--option-bg': 'rgba(236, 72, 153, 0.1)', '--map-filter': 'none' }
    };

    function applyTheme(themeName) {
        const theme = themes[themeName] || themes['default'];
        const root = document.documentElement;
        for (const [key, value] of Object.entries(theme)) {
            root.style.setProperty(key, value);
        }
        localStorage.setItem('rng_theme', themeName);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const savedTheme = localStorage.getItem('rng_theme') || 'default';
        const themeSelector = document.getElementById('themeSelector');
        if(themeSelector) {
            themeSelector.value = savedTheme;
            themeSelector.addEventListener('change', (e) => applyTheme(e.target.value));
        }
        applyTheme(savedTheme);

        const setupModal = (btnId, modalId, closeId) => {
            const btn = document.getElementById(btnId);
            const modal = document.getElementById(modalId);
            const close = document.getElementById(closeId);
            if(btn && modal && close) {
                btn.addEventListener('click', (e) => { e.preventDefault(); modal.classList.add('active'); });
                close.addEventListener('click', () => modal.classList.remove('active'));
                modal.addEventListener('click', (e) => { if(e.target === modal) modal.classList.remove('active'); });
            }
        };

        setupModal('settingsBtn', 'settingsModalOverlay', 'closeSettingsBtn');
        setupModal('teamBtn', 'teamModalOverlay', 'closeTeamBtn');
    });
</script>