<!DOCTYPE html>
<html lang="zh-TW">
<%- include('partials/header') %>

    <body id="app-body"
        class="bg-black text-white m-0 p-0 overflow-x-hidden transition-colors duration-500 font-sans min-h-screen">
        <%- include('partials/navbar') %>

            <div id="home-loader"
                class="fixed inset-0 z-[9999] bg-black flex flex-col items-center justify-center transition-opacity duration-1000">
                <div id="loader-orbit"
                    class="relative flex flex-col items-center justify-center transition-all duration-500 ease-in-out">
                    <div class="relative flex items-center justify-center">
                        <div
                            class="w-20 h-20 rounded-full bg-white/5 border border-white/10 flex items-center justify-center relative z-10 backdrop-blur-sm">
                            <span
                                class="material-symbols-rounded text-3xl text-blue-400 opacity-90 animate-pulse">restaurant</span>
                        </div>
                        <div
                            class="absolute w-24 h-24 rounded-full border-t-2 border-b-2 border-transparent border-t-blue-500 border-b-blue-500/30 animate-spin">
                        </div>
                        <div
                            class="absolute w-40 h-40 rounded-full border border-white/5 animate-[spin_3s_linear_infinite]">
                        </div>
                    </div>
                    <div class="mt-12 text-[10px] font-bold tracking-[0.5em] text-white/60">SYSTEM INITIALIZING</div>
                </div>
            </div>

            <main class="pt-20 pb-24">
                <div class="max-w-4xl mx-auto px-4 space-y-12 py-12">
                    <header class="text-center space-y-2">
                        <h1 class="text-5xl font-light tracking-tight">今天吃什麼？</h1>
                        <p class="opacity-50">拋開煩惱，讓機率幫你做主</p>
                    </header>

                    <div
                        class="p-8 rounded-[2rem] bg-gradient-to-br from-blue-500/10 to-purple-500/10 border border-blue-500/20 relative overflow-hidden group">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center gap-3">
                                <span class="material-symbols-rounded text-blue-400">psychology</span>
                                <span class="text-[10px] font-bold tracking-[0.2em] uppercase opacity-80">AI
                                    智能決策建議</span>
                            </div>
                            <div id="ai-feedback-container"
                                class="flex bg-black/5 rounded-full p-1 border border-white/5 relative z-10 transition-all opacity-0 group-hover:opacity-100">
                                <button onclick="handleAiFeedback('up')"
                                    class="w-8 h-8 flex items-center justify-center hover:text-blue-500 transition-colors rounded-full hover:bg-white/10">
                                    <span class="material-symbols-rounded text-sm">thumb_up</span>
                                </button>
                                <button onclick="handleAiFeedback('down')"
                                    class="w-8 h-8 flex items-center justify-center hover:text-red-500 transition-colors rounded-full hover:bg-white/10">
                                    <span class="material-symbols-rounded text-sm">thumb_down</span>
                                </button>
                            </div>
                        </div>
                        <p id="ai-tip" class="text-xl font-light leading-relaxed pr-8">正在思考中...</p>
                        <div
                            class="absolute -bottom-4 -right-4 opacity-5 group-hover:opacity-10 transition-all transform group-hover:scale-110">
                            <span class="material-symbols-rounded text-[120px]">robot_2</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="controls-area">
                        <button id="rng-btn" onclick="startRNG()"
                            class="h-28 rounded-[2rem] bg-white text-black font-medium text-xl tracking-wider hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-3 group">
                            <span
                                class="material-symbols-rounded group-hover:rotate-180 transition-transform duration-700">casino</span>
                            <span id="rng-btn-text">開始隨機抽選</span>
                        </button>
                        <button onclick="startRNG(true)"
                            class="h-28 rounded-[2rem] bg-zinc-900 border border-white/10 text-white font-medium text-xl tracking-wider hover:bg-zinc-800 active:scale-95 transition-all flex items-center justify-center gap-3 group">
                            <span
                                class="material-symbols-rounded group-hover:scale-125 transition-transform">bolt</span>
                            立即決定模式
                        </button>
                    </div>

                    <div id="rerolling-anim"
                        class="hidden py-20 flex-col items-center justify-center space-y-8 animate-in fade-in zoom-in duration-500">
                        <div class="relative w-40 h-40 flex items-center justify-center">
                            <div
                                class="absolute inset-0 border-2 border-dashed border-white/10 rounded-full animate-[spin_15s_linear_infinite]">
                            </div>
                            <div class="flex gap-4">
                                <span class="material-symbols-rounded text-6xl animate-bounce"
                                    style="animation-delay: 0s">ramen_dining</span>
                                <span class="material-symbols-rounded text-6xl animate-bounce"
                                    style="animation-delay: 0.2s">bakery_dining</span>
                                <span class="material-symbols-rounded text-6xl animate-bounce"
                                    style="animation-delay: 0.4s">egg_alt</span>
                            </div>
                        </div>
                        <div class="text-center space-y-3">
                            <p class="text-[10px] uppercase tracking-[0.5em] opacity-40 font-bold">正在從美食宇宙中挑選最適合您的選擇</p>
                            <div class="flex justify-center gap-2">
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"
                                    style="animation-delay: 0s"></div>
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"
                                    style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"
                                    style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>

                    <section class="glass p-8 rounded-[2rem] space-y-6">
                        <div class="flex items-center gap-2 mb-4 border-b border-white/10 pb-4">
                            <span class="material-symbols-rounded">tune</span>
                            <h2 class="text-xl font-light">進階篩選選項</h2>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <h3 class="text-5sm opacity-60">時段選擇</h3>
                                <div class="flex flex-wrap gap-2" id="time-filters">
                                    <% ['all', 'breakfast' , 'lunch' , 'dinner' ].forEach(t=> { %>
                                        <button data-val="<%= t %>" onclick="setFilter('time', '<%= t %>')"
                                            class="filter-btn-time px-4 py-2 rounded-full text-sm transition-all border <%= t === 'all' ? 'bg-white text-black border-white' : 'border-white/10 hover:border-white/30' %>">
                                            <%= t==='all' ? '全部' : t %>
                                        </button>
                                        <% }); %>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <h3 class="text-5sm opacity-60">食物種類</h3>
                                <select id="category-select" onchange="setFilter('category', this.value)"
                                    class="w-full bg-white/5 border border-white/10 p-3 rounded-xl outline-none focus:border-white/30 transition-colors">
                                    <option value="all" class="bg-zinc-900">全部種類</option>
                                    <option value="noodle" class="bg-zinc-900">麵食愛好</option>
                                    <option value="rice" class="bg-zinc-900">米飯主義</option>
                                    <option value="western" class="bg-zinc-900">西式/異國</option>
                                    <option value="light" class="bg-zinc-900">輕食/早點</option>
                                </select>
                            </div>
                        </div>
                    </section>

                    <section class="space-y-6">
                        <h3 class="text-xl font-light flex items-center gap-2">
                            <span class="material-symbols-rounded">history</span>
                            最近決策歷史
                        </h3>
                        <div id="history-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        </div>
                    </section>
                </div>
            </main>

            <div id="result-modal"
                class="hidden fixed inset-0 z-[100] items-center justify-center p-4 bg-black/90 backdrop-blur-md">
                <div
                    class="glass-dark w-full max-w-lg rounded-[3.5rem] p-12 border border-white/10 text-center relative overflow-hidden animate-in fade-in slide-in-from-bottom-8 duration-500">
                    <div class="text-[10px] uppercase tracking-[0.5em] opacity-30 font-bold mb-4">今日精選推薦項目</div>
                    <h2 id="res-name" class="text-5xl font-light tracking-tight mb-4"></h2>
                    <div id="res-stars" class="flex justify-center gap-1 text-yellow-500 mb-6"></div>

                    <div id="result-feedback-area" class="mb-8 pt-4 border-t border-white/5">
                        <div class="flex flex-col items-center gap-3">
                            <span class="text-[10px] tracking-[0.2em] uppercase font-bold opacity-40">這個選擇合您的胃口嗎？</span>
                            <div class="flex gap-4">
                                <button onclick="handleResultFeedback('up')"
                                    class="w-12 h-12 rounded-full border border-white/10 bg-white/5 flex items-center justify-center hover:bg-blue-500 hover:text-white transition-all group active:scale-90">
                                    <span
                                        class="material-symbols-rounded text-xl group-hover:scale-110">sentiment_satisfied</span>
                                </button>
                                <button onclick="handleResultFeedback('down')"
                                    class="w-12 h-12 rounded-full border border-white/10 bg-white/5 flex items-center justify-center hover:bg-red-500 hover:text-white transition-all group active:scale-90">
                                    <span
                                        class="material-symbols-rounded text-xl group-hover:scale-110">sentiment_dissatisfied</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 text-left mb-8">
                        <div class="p-6 rounded-[2rem] bg-white/5 border border-white/10">
                            <div class="text-sm uppercase tracking-[0.2em] opacity-40 mb-2 font-bold">地點</div>
                            <div id="res-loc" class="text-lg font-light leading-snug"></div>
                        </div>
                        <div class="p-6 rounded-[2rem] bg-white/5 border border-white/10">
                            <div class="text-sm uppercase tracking-[0.2em] opacity-40 mb-2 font-bold">價格</div>
                            <div id="res-price" class="text-lg font-light leading-snug"></div>
                        </div>
                    </div>

                    <div class="flex gap-3 justify-center">
                        <button onclick="toggleModal('result-modal')"
                            class="px-8 py-3 rounded-full border border-white/20 hover:bg-white/10 transition-colors">關閉</button>
                        <button onclick="toggleModal('result-modal'); startRNG()"
                            class="px-8 py-3 rounded-full bg-white text-black font-bold hover:scale-105 transition-transform">再抽一次</button>
                    </div>
                </div>
            </div>

            <section class="space-y-6">
            </section>
            </div>
            </main>

            <a href="/"
                class="fixed bottom-8 right-8 z-50 p-4 rounded-full glass hover:bg-white/20 transition-all shadow-lg flex items-center justify-center group border border-white/10">
                <span
                    class="material-symbols-rounded text-2xl group-hover:-translate-x-1 transition-transform">arrow_back</span>
                <span
                    class="max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-500 ease-in-out whitespace-nowrap text-sm font-bold tracking-widest group-hover:ml-2">回首頁</span>
            </a>

            <script>
                // ★ 亞東科大附近真實美食資料 (測試用)
                window.FOOD_DATA = [
                    {
                        id: '1',
                        name: "北方牛肉麵",
                        rating: "湯頭濃郁，肉塊厚實，學生最愛",
                        description: "亞東醫院後方巷弄隱藏美食，招牌紅燒牛肉麵與手工水餃是必點。",
                        location: "板橋區四川路二段47巷4弄4號",
                        price: "NT$ 130",
                        stars: 4,
                        category: "noodle",
                        time: ["lunch", "dinner"],
                        tags: ["popular", "traditional"],
                        lat: 24.9972, lng: 121.4528
                    },
                    {
                        id: '2',
                        name: "NU PASTA 板橋亞東店",
                        rating: "環境舒適，平價義大利麵首選",
                        description: "提供多樣化的義大利麵、燉飯與吐司盒子，適合聚餐聊天的舒適空間。",
                        location: "板橋區南雅南路二段144巷2號",
                        price: "NT$ 180",
                        stars: 5,
                        category: "western",
                        time: ["lunch", "dinner"],
                        tags: ["date", "comfortable"],
                        lat: 24.9985, lng: 121.4542
                    },
                    {
                        id: '3',
                        name: "Good Morning 早午餐",
                        rating: "活力早晨，多樣化選擇",
                        description: "人氣很高的早午餐店，推薦花生厚牛起司堡與各式蛋餅，份量十足。",
                        location: "板橋區四川路一段349號",
                        price: "NT$ 65",
                        stars: 4,
                        category: "light",
                        time: ["breakfast", "lunch"],
                        tags: ["breakfast", "quick"],
                        lat: 24.9990, lng: 121.4550
                    },
                    {
                        id: '4',
                        name: "粩泰泰-泰式料理",
                        rating: "高CP值，道地酸辣滋味",
                        description: "隱身巷弄的平價泰式料理，打拋豬肉飯與月亮蝦餅是學生族的最愛。",
                        location: "板橋區四川路二段47巷4弄6號",
                        price: "NT$ 100",
                        stars: 4,
                        category: "rice",
                        time: ["lunch", "dinner"],
                        tags: ["spicy", "exotic"],
                        lat: 24.9970, lng: 121.4525
                    },
                    {
                        id: '5',
                        name: "亞東汕頭意麵",
                        rating: "傳統古早味，銅板美食",
                        description: "瑞億市場內的老字號麵店，特製沙茶拌麵香氣十足，價格親民。",
                        location: "板橋區四川路二段47巷8弄8號",
                        price: "NT$ 50",
                        stars: 4,
                        category: "noodle",
                        time: ["lunch", "dinner"],
                        tags: ["budget", "traditional"],
                        lat: 24.9968, lng: 121.4522
                    },
                    {
                        id: '6',
                        name: "開心飯糰1號站",
                        rating: "口味超多，米飯Q彈",
                        description: "被稱為「猛男飯糰」的人氣早餐攤，口味多達30種，紫米飯糰非常受歡迎。",
                        location: "板橋區南雅南路二段144巷8號",
                        price: "NT$ 45",
                        stars: 5,
                        category: "light",
                        time: ["breakfast"],
                        tags: ["breakfast", "takeout"],
                        lat: 24.9982, lng: 121.4545
                    },
                    {
                        id: '7',
                        name: "歐義式 ALL 14 WELL",
                        rating: "浮誇蛤蜊麵，網美打卡點",
                        description: "以浮誇系義大利麵聞名，招牌「蒜香大爆炸白酒蛤蜊麵」蛤蜊滿到看不到麵。",
                        location: "板橋區南雅南路二段106號",
                        price: "NT$ 250",
                        stars: 5,
                        category: "western",
                        time: ["lunch", "dinner"],
                        tags: ["popular", "seafood"],
                        lat: 24.9978, lng: 121.4538
                    },
                    {
                        id: '8',
                        name: "爭牛牛肉麵專賣",
                        rating: "原汁原味，肉大塊",
                        description: "堅持不加粉的純熬湯頭，牛肉塊厚實軟嫩，是在地人推薦的牛肉麵店。",
                        location: "板橋區四川路二段121號",
                        price: "NT$ 140",
                        stars: 4,
                        category: "noodle",
                        time: ["lunch", "dinner"],
                        tags: ["beef", "soup"],
                        lat: 24.9955, lng: 121.4510
                    }
                ];

                console.log("亞東測試資料已載入，共 " + window.FOOD_DATA.length + " 筆");
            </script>

            <script src="/js/main.js"></script>
    </body>

</html>